name: openedx-lms-urls
content: |
  # Import required modules
  from django.urls import re_path, path
  from django.shortcuts import redirect
  from django.conf import settings
  from django.http import HttpResponsePermanentRedirect
  
  # Create a view that redirects DIRECTLY to SSO
  def direct_sso_redirect_view(request):
      """Redirect directly to Zitadel SSO"""
      sso_url = getattr(settings, 'SSO_REDIRECT_URL', '/auth/login/oidc/')
      
      # Make it absolute
      if sso_url.startswith('/'):
          protocol = 'https' if request.is_secure() else 'http'
          host = request.get_host()
          sso_url = f"{protocol}://{host}{sso_url}"
      
      next_url = request.GET.get('next', '/dashboard')
      if next_url:
          return HttpResponsePermanentRedirect(f"{sso_url}?next={next_url}")
      return HttpResponsePermanentRedirect(sso_url)
  
  # Override ALL authentication URLs to go DIRECTLY to SSO
  auth_redirects = [
      # Legacy login/register URLs
      re_path(r'^login/?$', direct_sso_redirect_view, name='signin_user'),
      re_path(r'^register/?$', direct_sso_redirect_view, name='register_user'),
      re_path(r'^signin/?$', direct_sso_redirect_view, name='login'),
      re_path(r'^signup/?$', direct_sso_redirect_view, name='register'),
      
      # API endpoints
      re_path(r'^user_api/v1/account/login_session/?$', direct_sso_redirect_view, name='login_session'),
      re_path(r'^api/user/v1/account/login_session/?$', direct_sso_redirect_view, name='login_session_api'),
      
      # Other auth URLs
      re_path(r'^auth/login/?$', direct_sso_redirect_view, name='auth_login'),
      re_path(r'^create_account/?$', direct_sso_redirect_view, name='create_account'),
      re_path(r'^ui/login.*$', direct_sso_redirect_view, name='ui_login'),
      
      # Catch-all for any login-like URL
      re_path(r'^.*(login|signin|register|signup).*$', direct_sso_redirect_view, name='catch_all_auth'),
  ]
  
  # Prepend our redirects to catch them first
  urlpatterns = auth_redirects + urlpatterns